{% extends "base.html" %}

{% block title %}Nova Vaga - TalentScope AI{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Cabeçalho Premium -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1 fw-bold text-dark">
                <i class="fas fa-plus-circle me-2 text-primary"></i>
                Nova Vaga
            </h1>
            <p class="text-muted mb-0">Crie uma nova vaga de forma rápida e eficiente</p>
        </div>
        <div class="d-flex align-items-center">
            <div class="me-3">
                <span class="badge bg-light text-dark border">
                    <i class="fas fa-save me-1"></i>
                    Rascunho
                </span>
            </div>
            <button type="button" class="btn btn-outline-secondary me-2" onclick="saveDraft()">
                <i class="fas fa-save me-1"></i>Salvar Rascunho
            </button>
        </div>
    </div>

    <!-- Breadcrumb Moderno -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-light rounded-3 p-3">
            <li class="breadcrumb-item">
                <a href="{{ url_for('dashboard') }}" class="text-decoration-none">
                    <i class="fas fa-home me-1"></i>Dashboard
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{{ url_for('jobs') }}" class="text-decoration-none">Vagas</a>
            </li>
            <li class="breadcrumb-item active text-primary fw-semibold">Nova Vaga</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Formulário Principal -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3 border-bottom">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h5 class="mb-0 fw-bold text-dark">
                                <i class="fas fa-briefcase me-2 text-primary"></i>
                                Informações da Vaga
                            </h5>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="urgentJob">
                            <label class="form-check-label small" for="urgentJob">
                                Vaga Urgente
                            </label>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="POST" id="jobForm" class="needs-validation" novalidate>
                        <!-- Título da Vaga -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold text-dark mb-3">
                                Título da Vaga *
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-heading text-muted"></i>
                                </span>
                                <input type="text" name="title" class="form-control border-start-0 ps-0" 
                                       placeholder="Ex: Desenvolvedor Frontend React Pleno" 
                                       required maxlength="200">
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <small class="form-text text-muted">
                                    Seja claro e objetivo no título da vaga
                                </small>
                                <small class="text-muted char-counter">0/200</small>
                            </div>
                            <div class="invalid-feedback">
                                Por favor, insira um título para a vaga.
                            </div>
                        </div>

                        <!-- Informações Básicas -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <label class="form-label fw-semibold text-dark">Nível *</label>
                                <select class="form-select" name="level" required>
                                    <option value="" selected disabled>Selecione o nível</option>
                                    <option value="estagio">Estágio</option>
                                    <option value="junior">Júnior</option>
                                    <option value="pleno">Pleno</option>
                                    <option value="senior">Sênior</option>
                                    <option value="especialista">Especialista</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-semibold text-dark">Tipo de Contratação *</label>
                                <select class="form-select" name="contract_type" required>
                                    <option value="" selected disabled>Selecione o tipo</option>
                                    <option value="clt">CLT</option>
                                    <option value="pj">PJ</option>
                                    <option value="freelancer">Freelancer</option>
                                    <option value="estagio">Estágio</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-semibold text-dark">Modalidade *</label>
                                <select class="form-select" name="modality" required>
                                    <option value="" selected disabled>Selecione a modalidade</option>
                                    <option value="presencial">Presencial</option>
                                    <option value="remoto">Remoto</option>
                                    <option value="hibrido">Híbrido</option>
                                </select>
                            </div>
                        </div>

                        <!-- Localização -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold text-dark">Localização</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0">
                                    <i class="fas fa-map-marker-alt text-muted"></i>
                                </span>
                                <input type="text" name="location" class="form-control border-start-0 ps-0" 
                                       placeholder="Cidade, Estado ou Remoto">
                            </div>
                        </div>

                        <!-- Descrição da Vaga -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold text-dark mb-3">
                                Descrição da Vaga
                                <span class="badge bg-light text-dark ms-2 small">Opcional</span>
                            </label>
                            <div class="position-relative">
                                <textarea name="description" class="form-control" rows="6" 
                                          placeholder="Descreva as responsabilidades, atividades do dia a dia, contexto da vaga, cultura da empresa..."></textarea>
                                <div class="position-absolute bottom-0 end-0 p-3">
                                    <small class="text-muted description-counter">0/2000</small>
                                </div>
                            </div>
                            <small class="form-text text-muted mt-2">
                                Detalhe as atividades e responsabilidades do cargo
                            </small>
                        </div>

                        <!-- Requisitos -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold text-dark mb-3">
                                Requisitos e Qualificações
                                <span class="badge bg-light text-dark ms-2 small">Opcional</span>
                            </label>
                            <div class="position-relative">
                                <textarea name="requirements" class="form-control" rows="6" 
                                          placeholder="Liste os requisitos técnicos, experiência necessária, formação, competências comportamentais..."></textarea>
                                <div class="position-absolute bottom-0 end-0 p-3">
                                    <small class="text-muted requirements-counter">0/2000</small>
                                </div>
                            </div>
                            <small class="form-text text-muted mt-2">
                                Inclua requisitos obrigatórios e desejáveis
                            </small>
                        </div>

                        <!-- Benefícios -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold text-dark mb-3">
                                Benefícios
                                <span class="badge bg-light text-dark ms-2 small">Opcional</span>
                            </label>
                            <div class="position-relative">
                                <textarea name="benefits" class="form-control" rows="4" 
                                          placeholder="Liste os benefícios oferecidos (VR, VA, plano de saúde, etc)..."></textarea>
                                <div class="position-absolute bottom-0 end-0 p-3">
                                    <small class="text-muted benefits-counter">0/1000</small>
                                </div>
                            </div>
                        </div>

                        <!-- Salário -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold text-dark">Faixa Salarial</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light">R$</span>
                                    <input type="number" name="salary_min" class="form-control" placeholder="Mínimo">
                                    <span class="input-group-text bg-transparent border-0">-</span>
                                    <input type="number" name="salary_max" class="form-control" placeholder="Máximo">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold text-dark">Período</label>
                                <select class="form-select" name="salary_period">
                                    <option value="mensal" selected>Mensal</option>
                                    <option value="anual">Anual</option>
                                </select>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="d-flex gap-3 pt-4 border-top">
                            <button type="submit" class="btn btn-primary btn-lg px-4 flex-fill">
                                <i class="fas fa-rocket me-2"></i>Publicar Vaga
                            </button>
                            <button type="button" class="btn btn-outline-secondary px-4" onclick="previewJob()">
                                <i class="fas fa-eye me-2"></i>Pré-visualizar
                            </button>
                            <a href="{{ url_for('jobs') }}" class="btn btn-light px-4">
                                <i class="fas fa-times me-2"></i>Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar de Ajuda e Exemplos -->
        <div class="col-lg-4">
            <!-- Progresso -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-semibold text-dark">
                        <i class="fas fa-tasks me-2 text-primary"></i>
                        Progresso da Vaga
                    </h6>
                </div>
                <div class="card-body">
                    <div class="progress mb-3" style="height: 8px;">
                        <div class="progress-bar" role="progressbar" style="width: 25%;" 
                             aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>Completude</span>
                        <span>25%</span>
                    </div>
                    <ul class="list-unstyled mt-3 small">
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span class="text-muted">Informações básicas</span>
                        </li>
                        <li class="mb-2">
                            <i class="far fa-circle text-muted me-2"></i>
                            <span class="text-muted">Descrição detalhada</span>
                        </li>
                        <li class="mb-2">
                            <i class="far fa-circle text-muted me-2"></i>
                            <span class="text-muted">Requisitos</span>
                        </li>
                        <li class="mb-2">
                            <i class="far fa-circle text-muted me-2"></i>
                            <span class="text-muted">Benefícios</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Dicas Rápidas -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-semibold text-dark">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>
                        Dicas para uma Vaga Atraente
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-bullseye text-primary"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="fw-semibold mb-1">Seja Específico</h6>
                            <p class="small text-muted mb-0">Mencione tecnologias, frameworks e ferramentas específicas.</p>
                        </div>
                    </div>
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-chart-line text-success"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="fw-semibold mb-1">Destaque Oportunidades</h6>
                            <p class="small text-muted mb-0">Mencione crescimento profissional e projetos desafiadores.</p>
                        </div>
                    </div>
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-users text-info"></i>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="fw-semibold mb-1">Cultura da Empresa</h6>
                            <p class="small text-muted mb-0">Descreva o ambiente de trabalho e valores da empresa.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exemplo Rápido -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-semibold text-dark">
                        <i class="fas fa-star me-2 text-primary"></i>
                        Exemplo de Destaque
                    </h6>
                </div>
                <div class="card-body">
                    <div class="bg-light rounded p-3">
                        <h6 class="fw-bold text-dark mb-2">Desenvolvedor Frontend React</h6>
                        <p class="small text-muted mb-2">
                            <strong>Nível:</strong> Pleno<br>
                            <strong>Modalidade:</strong> Híbrido<br>
                            <strong>Salário:</strong> R$ 8.000 - R$ 12.000
                        </p>
                        <p class="small text-muted mb-0">
                            <strong>Tecnologias:</strong> React, TypeScript, Next.js, Figma
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Pré-visualização -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Pré-visualização da Vaga</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="previewContent">
                <!-- Conteúdo da pré-visualização será inserido aqui via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('jobForm').submit()">
                    <i class="fas fa-rocket me-2"></i>Publicar Vaga
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Focar no campo de título
    document.querySelector('input[name="title"]').focus();
    
    // Inicializar contadores
    initCounters();
    
    // Validação do formulário
    initFormValidation();
    
    // Atualizar progresso em tempo real
    initProgressTracker();
});

function initCounters() {
    const titleInput = document.querySelector('input[name="title"]');
    const descriptionTextarea = document.querySelector('textarea[name="description"]');
    const requirementsTextarea = document.querySelector('textarea[name="requirements"]');
    const benefitsTextarea = document.querySelector('textarea[name="benefits"]');
    
    function updateCounter(element, counterClass, maxLength) {
        const counter = document.querySelector(`.${counterClass}`);
        if (counter) {
            counter.textContent = `${element.value.length}/${maxLength}`;
            
            // Mudar cor se estiver perto do limite
            if (element.value.length > maxLength * 0.9) {
                counter.classList.add('text-warning');
            } else {
                counter.classList.remove('text-warning');
            }
        }
    }
    
    titleInput.addEventListener('input', function() {
        updateCounter(this, 'char-counter', 200);
        updateProgress();
    });
    
    descriptionTextarea.addEventListener('input', function() {
        updateCounter(this, 'description-counter', 2000);
        updateProgress();
    });
    
    requirementsTextarea.addEventListener('input', function() {
        updateCounter(this, 'requirements-counter', 2000);
        updateProgress();
    });
    
    benefitsTextarea.addEventListener('input', function() {
        updateCounter(this, 'benefits-counter', 1000);
        updateProgress();
    });
    
    // Inicializar contadores
    updateCounter(titleInput, 'char-counter', 200);
    updateCounter(descriptionTextarea, 'description-counter', 2000);
    updateCounter(requirementsTextarea, 'requirements-counter', 2000);
    updateCounter(benefitsTextarea, 'benefits-counter', 1000);
}

function initFormValidation() {
    const form = document.getElementById('jobForm');
    
    form.addEventListener('submit', function(e) {
        if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        form.classList.add('was-validated');
    });
}

function initProgressTracker() {
    updateProgress();
    
    // Observar mudanças nos campos principais
    const fields = document.querySelectorAll('#jobForm input, #jobForm textarea, #jobForm select');
    fields.forEach(field => {
        field.addEventListener('input', updateProgress);
        field.addEventListener('change', updateProgress);
    });
}

function updateProgress() {
    let completed = 0;
    const totalFields = 6; // título, nível, contrato, modalidade, descrição, requisitos
    
    // Verificar campos obrigatórios
    if (document.querySelector('input[name="title"]').value.trim()) completed++;
    if (document.querySelector('select[name="level"]').value) completed++;
    if (document.querySelector('select[name="contract_type"]').value) completed++;
    if (document.querySelector('select[name="modality"]').value) completed++;
    if (document.querySelector('textarea[name="description"]').value.trim()) completed++;
    if (document.querySelector('textarea[name="requirements"]').value.trim()) completed++;
    
    const progress = (completed / totalFields) * 100;
    const progressBar = document.querySelector('.progress-bar');
    const progressText = document.querySelector('.progress-text');
    
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
        progressBar.setAttribute('aria-valuenow', progress);
    }
    
    if (progressText) {
        progressText.textContent = `${Math.round(progress)}%`;
    }
}

function saveDraft() {
    // Simular salvamento de rascunho
    const toast = document.createElement('div');
    toast.className = 'position-fixed top-0 end-0 p-3';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
        <div class="toast show" role="alert">
            <div class="toast-header bg-success text-white">
                <i class="fas fa-save me-2"></i>
                <strong class="me-auto">Sucesso</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                Rascunho salvo com sucesso!
            </div>
        </div>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

function previewJob() {
    // Coletar dados do formulário
    const formData = new FormData(document.getElementById('jobForm'));
    const previewContent = document.getElementById('previewContent');
    
    // Construir preview
    let previewHTML = `
        <div class="card border-0 bg-light">
            <div class="card-body">
                <h4 class="fw-bold text-dark mb-3">${formData.get('title') || '[Título da Vaga]'}</h4>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Nível:</strong> ${formData.get('level') || 'Não especificado'}</p>
                        <p class="mb-1"><strong>Contratação:</strong> ${formData.get('contract_type') || 'Não especificado'}</p>
                    </div>
                    <div class="col-md-6">
                        <p class="mb-1"><strong>Modalidade:</strong> ${formData.get('modality') || 'Não especificado'}</p>
                        <p class="mb-1"><strong>Localização:</strong> ${formData.get('location') || 'Não especificada'}</p>
                    </div>
                </div>
                
                ${formData.get('salary_min') ? `
                <div class="mb-3">
                    <strong>Salário:</strong> R$ ${formData.get('salary_min')} 
                    ${formData.get('salary_max') ? `- R$ ${formData.get('salary_max')}` : ''}
                    ${formData.get('salary_period') ? `(${formData.get('salary_period')})` : ''}
                </div>
                ` : ''}
                
                ${formData.get('description') ? `
                <div class="mb-3">
                    <h6 class="fw-bold">Descrição</h6>
                    <p class="text-muted">${formData.get('description')}</p>
                </div>
                ` : ''}
                
                ${formData.get('requirements') ? `
                <div class="mb-3">
                    <h6 class="fw-bold">Requisitos</h6>
                    <p class="text-muted">${formData.get('requirements')}</p>
                </div>
                ` : ''}
                
                ${formData.get('benefits') ? `
                <div class="mb-3">
                    <h6 class="fw-bold">Benefícios</h6>
                    <p class="text-muted">${formData.get('benefits')}</p>
                </div>
                ` : ''}
            </div>
        </div>
    `;
    
    previewContent.innerHTML = previewHTML;
    
    // Mostrar modal
    const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
    previewModal.show();
}
</script>

<style>
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
    --border-radius: 12px;
}

body {
    background-color: #f8fafc;
}

.card {
    border-radius: var(--border-radius);
    border: none;
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-control-lg {
    font-size: 1.1rem;
    font-weight: 500;
}

.input-group-text {
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
    border-right: none;
}

.input-group .form-control {
    border-left: none;
}

.input-group .form-control:focus {
    border-left: 1px solid #3b82f6;
    margin-left: -1px;
}

.btn {
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.2s ease;
}

.btn-primary {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    border: none;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.breadcrumb {
    background: linear-gradient(135deg, #ffffff, #f8fafc);
    border-radius: 10px;
}

.breadcrumb-item.active {
    color: #3b82f6;
    font-weight: 600;
}

.progress {
    border-radius: 10px;
    background-color: #e2e8f0;
}

.progress-bar {
    background: linear-gradient(135deg, #10b981, #059669);
    border-radius: 10px;
    transition: width 0.5s ease;
}

.badge {
    border-radius: 6px;
    font-weight: 500;
}

/* Animações suaves */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    animation: fadeIn 0.5s ease;
}

/* Responsividade aprimorada */
@media (max-width: 768px) {
    .container-fluid {
        padding: 15px;
    }
    
    .d-flex.gap-3 {
        flex-direction: column;
    }
    
    .btn {
        margin-bottom: 0.5rem;
        width: 100%;
    }
    
    .input-group-lg {
        flex-direction: column;
    }
    
    .input-group-lg .input-group-text {
        border-radius: 8px 8px 0 0;
        border-right: 1px solid #e2e8f0;
        border-bottom: none;
    }
    
    .input-group-lg .form-control {
        border-radius: 0 0 8px 8px;
        border-left: 1px solid #e2e8f0;
        border-top: none;
    }
    
    .card-body {
        padding: 1.5rem;
    }
}

/* Estados de foco melhorados */
.form-label {
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
}

.invalid-feedback {
    font-weight: 500;
}

/* Tooltips personalizados */
.tooltip-inner {
    border-radius: 6px;
    background-color: #1e293b;
}

/* Modal estilizado */
.modal-content {
    border-radius: var(--border-radius);
    border: none;
    box-shadow: var(--shadow-lg);
}

.modal-header {
    border-bottom: 1px solid #e2e8f0;
    background: linear-gradient(135deg, #f8fafc, #ffffff);
    border-radius: var(--border-radius) var(--border-radius) 0 0;
}

/* Ícones com gradiente */
.text-primary {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
</style>
{% endblock %}